<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cassa Simulator 2026 | NFC Pro Edition</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1c1c2e 0%, #111119 100%);
            --card-bg: rgba(40, 40, 55, 0.7);
            --card-border: 1px solid rgba(255, 255, 255, 0.1);
            --primary: #4f8aff;
            --success: #00d26a;
            --danger: #ff4757;
            --text-main: #ffffff;
            --radius: 16px;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-gradient); color: var(--text-main); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .top-bar { background: rgba(30, 30, 40, 0.8); backdrop-filter: blur(10px); padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; border-bottom: var(--card-border); }
        .brand { font-size: 1.2rem; font-weight: 800; color: var(--primary); }
        .terminal-control { display: flex; align-items: center; gap: 15px; }

        input { background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; padding: 10px 15px; border-radius: 8px; outline: none; }
        
        button { border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: #000; }
        .btn-nfc { background: #6c5ce7; color: white; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è NFC */

        .main-container { flex: 1; padding: 20px 30px; display: flex; gap: 20px; }
        .card { background: var(--card-bg); border: var(--card-border); border-radius: var(--radius); padding: 20px; flex: 1; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #777; font-size: 0.8rem; padding: 10px; }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .item-row:hover { background: rgba(255,255,255,0.05); cursor: pointer; }

        .total-amount { font-size: 2.5rem; font-weight: 800; text-align: center; margin: 20px 0; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-box { background: #252530; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; }

        .status-dot { height: 10px; width: 10px; background: #555; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-dot.active { background: var(--success); box-shadow: 0 0 10px var(--success); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="brand">CASSA <span style="color:white; font-weight:300;">PRO</span></div>
        <div class="terminal-control">
            <span id="statusLabel" style="color:#777;"><span class="status-dot" id="statusDot"></span> –û—Ñ—Ñ–ª–∞–π–Ω</span>
            <input type="number" id="terminalInput" placeholder="ID –¢–µ—Ä–º–∏–Ω–∞–ª–∞">
            <button class="btn-primary" onclick="bindTerminal()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
        </div>
    </div>

    <div class="main-container">
        <div class="card">
            <h2>üì¶ –ö–∞—Ç–∞–ª–æ–≥</h2>
            <div style="overflow-y:auto;">
                <table id="salesTable">
                    <thead><tr><th>–¢–æ–≤–∞—Ä</th><th style="text-align:right">–¶–µ–Ω–∞</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="card" style="max-width: 400px;">
            <h2>üõí –¢–µ–∫—É—â–∏–π —á–µ–∫</h2>
            <div style="flex:1; overflow-y:auto;" id="cartList">
                <table id="cartTable"><tbody></tbody></table>
            </div>
            <div class="total-amount" id="totalLabel">0.00 ‚ÇΩ</div>
            <button class="btn-success" style="width:100%; padding:20px;" onclick="openModal('paymentModal')">–û–ü–õ–ê–¢–ò–¢–¨</button>
        </div>
    </div>

    <div id="paymentModal" class="modal">
        <div class="modal-box">
            <h2>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h2>
            <div style="display:grid; gap:10px; margin-top:20px;">
                <button class="btn-primary" onclick="payCard()">üí≥ –û–ø–ª–∞—Ç–∞ –ø–æ –∫–∞—Ä—Ç–µ (–¢–µ—Ä–º–∏–Ω–∞–ª)</button>
                <button class="btn-nfc" onclick="openNFC()">üì° –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å NFC –º–µ—Ç–∫—É</button>
                <button class="btn-success" onclick="alert('–û–ø–ª–∞—á–µ–Ω–æ –Ω–∞–ª–∏—á–Ω—ã–º–∏!'); clearCart(); closeModal('paymentModal');">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</button>
                <button style="background:transparent; color:#777;" onclick="closeModal('paymentModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="nfcModal" class="modal">
        <div class="modal-box">
            <h2 style="color: #6c5ce7;">üì° NFC –≠–º—É–ª—è—Ç–æ—Ä</h2>
            <p style="font-size: 0.9rem; color: #aaa;">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–ª—è "–ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è" –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É #${terminalId || '?'}</p>
            <input type="text" id="nfcCardInput" placeholder="4400 0000..." style="width:100%; margin: 15px 0; text-align:center; font-size:1.2rem;">
            <button class="btn-nfc" style="width:100%;" onclick="sendNFCToTerminal()">–ü–†–ò–õ–û–ñ–ò–¢–¨ –ú–ï–¢–ö–£</button>
            <button style="background:transparent; color:#777; margin-top:10px;" onclick="closeModal('nfcModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        const DB_URL = "https://cassa-simulator-4-default-rtdb.firebaseio.com";
        let products = [
            {id: 1, name: "–ö–æ—Ñ–µ –õ–∞—Ç–µ", price: 250},
            {id: 2, name: "–ë—É—Ä–≥–µ—Ä –ö–ª–∞—Å—Å–∏–∫", price: 450},
            {id: 3, name: "–ß–∏–ø—Å—ã Lay's", price: 120}
        ];
        let cart = [];
        let total = 0;
        let terminalId = localStorage.getItem('terminalId');

        window.onload = () => {
            renderCatalog();
            if(terminalId) {
                document.getElementById('terminalInput').value = terminalId;
                bindTerminal();
            }
        };

        function renderCatalog() {
            const tbody = document.querySelector('#salesTable tbody');
            tbody.innerHTML = products.map(p => `
                <tr class="item-row" onclick="addToCart(${p.id})">
                    <td>${p.name}</td>
                    <td style="text-align:right; color:var(--success); font-weight:bold;">${p.price} ‚ÇΩ</td>
                </tr>
            `).join('');
        }

        function addToCart(id) {
            const p = products.find(x => x.id === id);
            cart.push(p);
            updateCart();
        }

        function updateCart() {
            const tbody = document.querySelector('#cartTable tbody');
            total = cart.reduce((sum, p) => sum + p.price, 0);
            tbody.innerHTML = cart.map(p => `<tr><td>${p.name}</td><td style="text-align:right;">${p.price}</td></tr>`).join('');
            document.getElementById('totalLabel').innerText = total.toFixed(2) + " ‚ÇΩ";
        }

        function clearCart() { cart = []; updateCart(); }

        function bindTerminal() {
            terminalId = document.getElementById('terminalInput').value;
            if(!terminalId) return;
            localStorage.setItem('terminalId', terminalId);
            document.getElementById('statusDot').classList.add('active');
            document.getElementById('statusLabel').innerHTML = `<span class="status-dot active"></span> –¢–µ—Ä–º–∏–Ω–∞–ª #${terminalId}`;
        }

        // --- NFC –õ–û–ì–ò–ö–ê ---
        function openNFC() {
            if(!terminalId) return alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª!");
            closeModal('paymentModal');
            openModal('nfcModal');
        }

        async function sendNFCToTerminal() {
            const cardNum = document.getElementById('nfcCardInput').value.replace(/\s/g, '');
            if(!cardNum) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã!");

            try {
                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –≤ –±–∞–∑—É NFC –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
                await fetch(`${DB_URL}/nfc_data/${terminalId}.json`, {
                    method: 'PUT',
                    body: JSON.stringify(cardNum)
                });
                alert("–°–∏–≥–Ω–∞–ª NFC –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª!");
                closeModal('nfcModal');
            } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏"); }
        }

        async function payCard() {
            if(!terminalId) return alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º");
            await fetch(`${DB_URL}/commands/${terminalId}.json`, {
                method: 'PUT',
                body: JSON.stringify({ command: "PAY", amount: total })
            });
            alert("–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ñ–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—ã –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
            closeModal('paymentModal');
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
