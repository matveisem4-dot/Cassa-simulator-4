<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–ê–°–°–ê ELITE v4.5 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --card-bg: #161625;
            --accent: #00ff41;
            --primary: #007bff;
            --danger: #ff4d4d;
            --text: #ffffff;
            --border: rgba(255,255,255,0.1);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–ù–∞–≤–∏–≥–∞—Ü–∏—è) */
        .sidebar {
            width: 80px; background: #05050a; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; padding: 20px 0;
        }
        .nav-item {
            cursor: pointer; font-size: 24px; margin-bottom: 30px; opacity: 0.5; transition: 0.3s;
        }
        .nav-item.active { opacity: 1; color: var(--accent); transform: scale(1.2); }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main { flex: 1; display: flex; flex-direction: column; padding: 25px; gap: 20px; }
        
        header { display: flex; justify-content: space-between; align-items: center; }
        .tid-box { background: var(--card-bg); padding: 10px 20px; border-radius: 12px; border: 1px solid var(--border); }
        .tid-box input { background: none; border: none; color: var(--accent); font-weight: bold; width: 80px; text-align: center; outline: none; }

        .content-row { display: flex; flex: 1; gap: 20px; overflow: hidden; }

        .panel { background: var(--card-bg); border-radius: 20px; padding: 20px; border: 1px solid var(--border); display: flex; flex-direction: column; }
        .catalog { flex: 2; }
        .cart { flex: 1.2; background: #1c1c2e; }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .scroll-area { flex: 1; overflow-y: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .clickable-tr:hover { background: rgba(255,255,255,0.05); cursor: pointer; }

        /* –û–ø–ª–∞—Ç–∞ */
        .total-box { margin-top: auto; padding-top: 20px; border-top: 2px solid var(--border); }
        .big-sum { font-size: 3rem; font-weight: 800; color: var(--accent); text-align: center; }
        
        .btn-main {
            background: var(--accent); color: #000; border: none; padding: 20px;
            border-radius: 15px; font-weight: bold; font-size: 1.2rem; cursor: pointer; width: 100%;
        }

        /* –ú–æ–¥–∞–ª–∫–∏ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 30px; width: 400px; text-align: center; }
        
        .input-pay { width: 100%; padding: 15px; font-size: 1.5rem; border-radius: 10px; border: 1px solid #444; background: #000; color: #fff; text-align: center; }
        .change-text { margin-top: 15px; font-size: 1.2rem; font-weight: bold; }
        .red { color: var(--danger); }
        .green { color: var(--accent); }

        /* –°–∫–ª–∞–¥ */
        .inventory-form { display: grid; gap: 10px; margin-bottom: 20px; }
        .inventory-form input { padding: 10px; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--primary); padding: 10px 30px; border-radius: 50px; display: none; }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div class="sidebar">
        <div class="nav-item active" onclick="showPage('page-sales', this)">üõí</div>
        <div class="nav-item" onclick="showPage('page-stock', this)">üì¶</div>
        <div class="nav-item" onclick="showPage('page-nfc', this)">üì°</div>
    </div>

    <div class="main">
        <header>
            <h1 style="margin:0">CASHIER<span style="color:var(--accent)">PRO</span></h1>
            <div class="tid-box">–¢–ï–†–ú–ò–ù–ê–õ: <input type="text" id="tid-val" placeholder="000000" onchange="saveTid()"></div>
        </header>

        <div id="page-sales" class="content-row">
            <div class="panel catalog">
                <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
                <div class="scroll-area">
                    <table id="catalog-table"><tbody></tbody></table>
                </div>
            </div>
            <div class="panel cart">
                <h2>–¢–µ–∫—É—â–∏–π —á–µ–∫</h2>
                <div class="scroll-area">
                    <table id="cart-table"><tbody></tbody></table>
                </div>
                <div class="total-box">
                    <div class="big-sum" id="total-val">0.00 ‚ÇΩ</div>
                    <button class="btn-main" onclick="openPayModal()">–û–ü–õ–ê–¢–ò–¢–¨</button>
                </div>
            </div>
        </div>

        <div id="page-stock" class="content-row" style="display:none">
            <div class="panel" style="width: 100%;">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º</h2>
                <div class="inventory-form">
                    <input type="text" id="new-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                    <input type="number" id="new-price" placeholder="–¶–µ–Ω–∞">
                    <button class="btn-main" style="padding:10px" onclick="addToStock()">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–∫–ª–∞–¥</button>
                </div>
                <div class="scroll-area">
                    <table id="stock-table">
                        <thead><tr style="color:#888"><td>–¢–æ–≤–∞—Ä</td><td>–¶–µ–Ω–∞</td><td>–î–µ–π—Å—Ç–≤–∏–µ</td></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-nfc" class="content-row" style="display:none">
            <div class="panel" style="width: 100%; align-items: center; justify-content: center;">
                <div style="font-size: 80px;">üì°</div>
                <h2>NFC –ü–µ—Ä–µ–¥–∞—Ç—á–∏–∫</h2>
                <p>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É –≤ –ø–∞–º—è—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</p>
                <input type="text" id="nfc-card-num" class="input-pay" style="width: 300px; margin-bottom: 10px;" placeholder="**** **** **** ****">
                <button class="btn-main" style="width:300px" onclick="sendNfcToTerminal()">–ó–ê–ü–ò–°–ê–¢–¨ –í –¢–ï–†–ú–ò–ù–ê–õ</button>
            </div>
        </div>
    </div>

    <div id="pay-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-sum">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</h2>
            <div style="display:flex; gap:10px; margin-bottom: 20px;">
                <button class="btn-main" style="background:#444; color:#fff;" onclick="setPayMethod('cash')">–ù–∞–ª–∏—á–Ω—ã–µ</button>
                <button class="btn-main" style="background:#444; color:#fff;" onclick="setPayMethod('card')">–ö–∞—Ä—Ç–∞</button>
            </div>

            <div id="cash-section" style="display:none">
                <p>–í–Ω–µ—Å–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º:</p>
                <input type="number" id="cash-in" class="input-pay" oninput="calcChange()">
                <div id="change-display" class="change-text"></div>
                <button class="btn-main" id="btn-finish-cash" style="margin-top:20px; display:none" onclick="finishCash()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
            </div>

            <div id="card-section" style="display:none">
                <p>–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ...</p>
                <div class="change-text green">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</div>
            </div>

            <button onclick="closeModal()" style="background:none; border:none; color:#888; margin-top:20px; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const DB = "https://cassa-simulator-4-default-rtdb.firebaseio.com";
        let tid = localStorage.getItem('tid') || "";
        let stock = JSON.parse(localStorage.getItem('my_stock')) || [
            {id: 1, name: "–ö–æ—Ñ–µ", price: 150},
            {id: 2, name: "–ü–æ–Ω—á–∏–∫", price: 80}
        ];
        let cart = [];
        let currentTotal = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('tid-val').value = tid;
        renderAll();

        function showPage(id, el) {
            document.querySelectorAll('.content-row').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        function saveTid() {
            tid = document.getElementById('tid-val').value;
            localStorage.setItem('tid', tid);
            msg("–¢–µ—Ä–º–∏–Ω–∞–ª –ø—Ä–∏–≤—è–∑–∞–Ω: " + tid);
        }

        // –°–ö–õ–ê–î
        function addToStock() {
            const name = document.getElementById('new-name').value;
            const price = parseFloat(document.getElementById('new-price').value);
            if(name && price) {
                stock.push({id: Date.now(), name, price});
                localStorage.setItem('my_stock', JSON.stringify(stock));
                renderAll();
                document.getElementById('new-name').value = '';
                document.getElementById('new-price').value = '';
            }
        }

        function delFromStock(id) {
            stock = stock.filter(s => s.id !== id);
            localStorage.setItem('my_stock', JSON.stringify(stock));
            renderAll();
        }

        // –ö–û–†–ó–ò–ù–ê
        function addToCart(id) {
            const item = stock.find(s => s.id === id);
            cart.push(item);
            renderCart();
        }

        function renderAll() {
            const cTable = document.querySelector('#catalog-table tbody');
            const sTable = document.querySelector('#stock-table tbody');
            cTable.innerHTML = ''; sTable.innerHTML = '';
            stock.forEach(s => {
                cTable.innerHTML += `<tr class="clickable-tr" onclick="addToCart(${s.id})"><td>${s.name}</td><td style="text-align:right">${s.price} ‚ÇΩ</td></tr>`;
                sTable.innerHTML += `<tr><td>${s.name}</td><td>${s.price} ‚ÇΩ</td><td><button onclick="delFromStock(${s.id})" style="color:red; background:none; border:none; cursor:pointer">–£–¥–∞–ª–∏—Ç—å</button></td></tr>`;
            });
        }

        function renderCart() {
            const cTable = document.querySelector('#cart-table tbody');
            cTable.innerHTML = '';
            currentTotal = 0;
            cart.forEach(item => {
                cTable.innerHTML += `<tr><td>${item.name}</td><td style="text-align:right">${item.price} ‚ÇΩ</td></tr>`;
                currentTotal += item.price;
            });
            document.getElementById('total-val').innerText = currentTotal.toFixed(2) + " ‚ÇΩ";
        }

        // –û–ü–õ–ê–¢–ê
        function openPayModal() {
            if(currentTotal === 0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");
            document.getElementById('modal-sum').innerText = "–ò—Ç–æ–≥–æ: " + currentTotal.toFixed(2) + " ‚ÇΩ";
            document.getElementById('pay-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('pay-modal').style.display = 'none';
            document.getElementById('cash-section').style.display = 'none';
            document.getElementById('card-section').style.display = 'none';
        }

        function setPayMethod(m) {
            document.getElementById('cash-section').style.display = m === 'cash' ? 'block' : 'none';
            document.getElementById('card-section').style.display = m === 'card' ? 'block' : 'none';
            
            if(m === 'card') {
                if(!tid) {
                    alert("–û–®–ò–ë–ö–ê: –¢–µ—Ä–º–∏–Ω–∞–ª –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω!");
                    closeModal();
                    return;
                }
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª
                fetch(`${DB}/commands/${tid}.json`, {
                    method: 'PUT',
                    body: JSON.stringify({command: "PAY", amount: currentTotal})
                });
            }
        }

        function calcChange() {
            const input = parseFloat(document.getElementById('cash-in').value) || 0;
            const display = document.getElementById('change-display');
            const btn = document.getElementById('btn-finish-cash');

            if(input < currentTotal) {
                display.innerHTML = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ: <span class="red">${(currentTotal - input).toFixed(2)} ‚ÇΩ</span>`;
                btn.style.display = 'none';
            } else {
                display.innerHTML = `–°–¥–∞—á–∞: <span class="green">${(input - currentTotal).toFixed(2)} ‚ÇΩ</span>`;
                btn.style.display = 'block';
            }
        }

        function finishCash() {
            msg("–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏–Ω—è—Ç–∞!");
            cart = [];
            renderCart();
            closeModal();
        }

        async function sendNfcToTerminal() {
            const card = document.getElementById('nfc-card-num').value;
            if(!tid || !card) return alert("–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ –∫–∞—Ä—Ç—É!");
            await fetch(`${DB}/commands/${tid}.json`, { method: 'PUT', body: JSON.stringify({command: "NFC_READ"}) });
            await fetch(`${DB}/nfc_data/${tid}.json`, { method: 'PUT', body: JSON.stringify(card) });
            msg("–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø–∏—Å–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        }

        function msg(t) {
            const el = document.getElementById('toast');
            el.innerText = t;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }
    </script>
</body>
</html>
