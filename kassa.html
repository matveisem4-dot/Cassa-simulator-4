<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cassa Simulator 2026 | Pro UI</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1c1c2e 0%, #111119 100%);
            --card-bg: rgba(40, 40, 55, 0.7);
            --card-border: 1px solid rgba(255, 255, 255, 0.1);
            --primary: #4f8aff; 
            --success: #00d26a; 
            --danger: #ff4757; 
            --text-main: #ffffff;
            --text-muted: #a0a0b0;
            --radius: 16px;
        }

        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-gradient); color: var(--text-main); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .top-bar { background: rgba(30, 30, 40, 0.8); backdrop-filter: blur(10px); padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; border-bottom: var(--card-border); z-index: 10; }
        .brand { font-size: 1.2rem; font-weight: 800; color: var(--primary); letter-spacing: 1px; }

        .terminal-control { display: flex; align-items: center; gap: 15px; }
        input { background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; padding: 10px 15px; border-radius: 8px; outline: none; }

        button { border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: #000; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-nfc { background: #6c5ce7; color: white; }

        .nav-tabs { display: flex; gap: 20px; padding: 20px 30px 0; }
        .tab-btn { background: transparent; color: var(--text-muted); padding: 10px 0; border-radius: 0; font-size: 1rem; position: relative; }
        .tab-btn.active { color: white; }
        .tab-btn.active::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 3px; background: var(--primary); box-shadow: 0 0 10px var(--primary); }

        .main-container { flex: 1; padding: 20px 30px; overflow: hidden; display: flex; }
        .tab-content { display: none; width: 100%; height: 100%; }
        .tab-content.active { display: flex; flex-direction: column; }

        .sales-layout { display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; height: 100%; }
        .card { background: var(--card-bg); border: var(--card-border); border-radius: var(--radius); padding: 20px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px); }

        .table-wrapper { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        td { background: rgba(255,255,255,0.03); padding: 12px 15px; }
        tr.item-row:hover td { background: rgba(255,255,255,0.08); cursor: pointer; }

        .total-section { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; margin-top: auto; }
        .total-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }

        /* NFC –ú–æ–¥—É–ª—å */
        .nfc-setup { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; height: 100%; }
        .nfc-icon { font-size: 50px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="brand">CASSA <span style="color:white; font-weight:300;">SIMULATOR</span></div>
        <div class="terminal-control">
            <span id="statusLabel" style="font-size: 0.9rem; color: #777;"><span class="status-dot" id="statusDot"></span> –û—Ñ—Ñ–ª–∞–π–Ω</span>
            <input type="number" id="terminalInput" placeholder="ID –¢–µ—Ä–º–∏–Ω–∞–ª–∞">
            <button class="btn-primary" onclick="bindTerminal()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
        </div>
    </div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('sales')">üõí –ü—Ä–æ–¥–∞–∂–∏</button>
        <button class="tab-btn" onclick="switchTab('products')">üì¶ –¢–æ–≤–∞—Ä—ã</button>
        <button class="tab-btn" onclick="switchTab('nfc-tab')">üì° NFC –ú–æ–¥—É–ª—å</button>
    </div>

    <div class="main-container">
        <div id="sales" class="tab-content active">
            <div class="sales-layout">
                <div class="card">
                    <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
                    <div class="table-wrapper">
                        <table id="salesTable"><tbody></tbody></table>
                    </div>
                </div>
                <div class="card">
                    <h2>–ß–µ–∫</h2>
                    <div class="table-wrapper"><table id="cartTable"><tbody></tbody></table></div>
                    <div class="total-section">
                        <div class="total-amount" id="totalLabel">0.00 ‚ÇΩ</div>
                        <button class="btn-success" style="width:100%; padding:15px;" onclick="payCard()">–û–ü–õ–ê–¢–ò–¢–¨ –ö–ê–†–¢–û–ô</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="products" class="tab-content">
            <div class="card">
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="pName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                    <input type="number" id="pPrice" placeholder="–¶–µ–Ω–∞">
                    <button class="btn-primary" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div class="table-wrapper"><table id="mgrTable"><tbody></tbody></table></div>
            </div>
        </div>

        <div id="nfc-tab" class="tab-content">
            <div class="card nfc-setup">
                <div class="nfc-icon">üì°</div>
                <h2>–≠–º—É–ª—è—Ü–∏—è NFC-–º–µ—Ç–∫–∏</h2>
                <p style="color:var(--text-muted)">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–π "–∑–∞–ø–∏—Å–∞–Ω" –Ω–∞ –º–µ—Ç–∫—É</p>
                <input type="text" id="nfcCardNum" placeholder="4400 0000 0000 0000" style="width:300px; text-align:center; font-size:1.2rem;">
                <button class="btn-nfc" onclick="emulateNFC()">–ü–†–ò–õ–û–ñ–ò–¢–¨ –ö –ö–ê–°–°–ï (–û–¢–ü–†–ê–í–ò–¢–¨)</button>
            </div>
        </div>
    </div>

    <script>
        const DB_URL = "https://cassa-simulator-4-default-rtdb.firebaseio.com";
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let cart = [];
        let terminalId = localStorage.getItem('terminalId');

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function render() {
            const sTable = document.querySelector('#salesTable tbody');
            sTable.innerHTML = products.map(p => `<tr class="item-row" onclick="addToCart(${p.id})"><td>${p.name}</td><td style="text-align:right">${p.price} ‚ÇΩ</td></tr>`).join('');
            
            const mTable = document.querySelector('#mgrTable tbody');
            mTable.innerHTML = products.map(p => `<tr><td>${p.name}</td><td>${p.price} ‚ÇΩ</td><td style="text-align:right"><button class="btn-danger" onclick="del(${p.id})">–£–¥–∞–ª–∏—Ç—å</button></td></tr>`).join('');
        }

        function addToCart(id) {
            cart.push(products.find(p => p.id === id));
            let total = cart.reduce((s, p) => s + p.price, 0);
            document.getElementById('cartTable').innerHTML = cart.map(p => `<tr><td>${p.name}</td><td>${p.price}</td></tr>`).join('');
            document.getElementById('totalLabel').innerText = total.toFixed(2) + " ‚ÇΩ";
        }

        function addProduct() {
            const name = document.getElementById('pName').value;
            const price = parseFloat(document.getElementById('pPrice').value);
            if(name && price) {
                products.push({id: Date.now(), name, price});
                localStorage.setItem('products', JSON.stringify(products));
                render();
            }
        }

        function bindTerminal() {
            terminalId = document.getElementById('terminalInput').value;
            localStorage.setItem('terminalId', terminalId);
            document.getElementById('statusDot').style.background = "#00d26a";
            document.getElementById('statusLabel').innerText = "–¢–µ—Ä–º–∏–Ω–∞–ª #" + terminalId;
        }

        async function emulateNFC() {
            const cardNum = document.getElementById('nfcCardNum').value.replace(/\s/g, '');
            if(!terminalId) return alert("–ü–æ–¥–∫–ª—é—á–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª!");
            await fetch(`${DB_URL}/nfc_data/${terminalId}.json`, { method: 'PUT', body: JSON.stringify(cardNum) });
            alert("–ö–∞—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª!");
        }

        async function payCard() {
            const total = parseFloat(document.getElementById('totalLabel').innerText);
            await fetch(`${DB_URL}/commands/${terminalId}.json`, { method: 'PUT', body: JSON.stringify({command: "PAY", amount: total}) });
            alert("–ñ–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—ã –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ...");
        }

        render();
    </script>
</body>
</html>
