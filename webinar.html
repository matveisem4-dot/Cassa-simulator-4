<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OpenStream Multi-Platform</title>
    <style>
        :root { --accent: #818cf8; --bg: #0f172a; --surface: #1e293b; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: white; display: flex; height: 100vh; }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å–ø–∏—Å–∫–æ–º —Å—Ç—Ä–∏–º–æ–≤ */
        .streams-sidebar { width: 250px; background: var(--surface); border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #334155; text-align: center; }
        #stream-list { flex: 1; overflow-y: auto; padding: 10px; }
        .stream-item { 
            padding: 12px; background: #334155; margin-bottom: 8px; border-radius: 8px; 
            cursor: pointer; transition: 0.2s; font-size: 14px;
        }
        .stream-item:hover { background: var(--accent); }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –∑–æ–Ω–∞ */
        .main-stage { flex: 1; display: flex; flex-direction: column; position: relative; }
        .video-container { flex: 1; background: #000; display: flex; align-items: center; justify-content: center; }
        iframe { width: 100%; height: 100%; border: none; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∏–º–∞ */
        #create-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            display: none; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-card { background: var(--surface); padding: 30px; border-radius: 15px; width: 300px; text-align: center; }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        
        button { background: var(--accent); border: none; padding: 10px 20px; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; width: 100%; }
        .fab { position: absolute; bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; font-size: 24px; }
    </style>
</head>
<body>

    <div class="streams-sidebar">
        <div class="sidebar-header"><b>–ê–ö–¢–ò–í–ù–´–ï –≠–§–ò–†–´</b></div>
        <div id="stream-list">
            <p style="text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        <button class="fab" onclick="document.getElementById('create-modal').style.display='flex'">+</button>
    </div>

    <div class="main-stage">
        <div class="video-container" id="player-zone">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é —Å–ª–µ–≤–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é üöÄ</h2>
        </div>
    </div>

    <div id="create-modal">
        <div class="modal-card">
            <h3>–ó–ê–ü–£–°–¢–ò–¢–¨ –°–¢–†–ò–ú</h3>
            <input type="text" id="stream-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏">
            <input type="text" id="stream-url" placeholder="ID –≤–∏–¥–µ–æ YouTube (–∏–ª–∏ —Å—Å—ã–ª–∫–∞)">
            <button onclick="publishStream()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨</button>
            <button onclick="document.getElementById('create-modal').style.display='none'" style="background:none; margin-top:10px; font-size:12px">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const DB_URL = "https://cassa-simulator-4-default-rtdb.firebaseio.com/multi_streams.json";

        // 1. –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–≤–æ–π —Å—Ç—Ä–∏–º
        async function publishStream() {
            const name = document.getElementById('stream-name').value;
            let url = document.getElementById('stream-url').value;

            // –ï—Å–ª–∏ –≤—Å—Ç–∞–≤–∏–ª–∏ –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É YouTube, –≤—ã—Ä–µ–∑–∞–µ–º —Ç–æ–ª—å–∫–æ ID
            if(url.includes('v=')) url = url.split('v=')[1].split('&')[0];
            if(url.includes('youtu.be/')) url = url.split('youtu.be/')[1];

            if(!name || !url) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");

            await fetch(DB_URL, {
                method: 'POST',
                body: JSON.stringify({ name, url, timestamp: Date.now() })
            });

            document.getElementById('create-modal').style.display = 'none';
            loadStreams();
        }

        // 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∏–º–æ–≤
        async function loadStreams() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                const list = document.getElementById('stream-list');
                list.innerHTML = "";

                for(let id in data) {
                    const s = data[id];
                    const item = document.createElement('div');
                    item.className = 'stream-item';
                    item.innerHTML = `<b>${s.name}</b><br><small>LIVE</small>`;
                    item.onclick = () => playStream(s.url);
                    list.appendChild(item);
                }
            } catch(e) {}
        }

        // 3. –í–∫–ª—é—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç—Ä–∏–º
        function playStream(videoID) {
            const zone = document.getElementById('player-zone');
            zone.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoID}?autoplay=1" allowfullscreen allow="autoplay"></iframe>`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(loadStreams, 5000);
        loadStreams();
    </script>
</body>
</html>
