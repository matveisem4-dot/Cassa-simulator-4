<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Терминал</title>
    <style>
        body { margin: 0; background: #000; font-family: sans-serif; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #terminal-ui { text-align: center; width: 90%; }
        .terminal-id-box { background: #222; padding: 20px; border-radius: 15px; border: 2px solid #444; margin-bottom: 20px; }
        .id-number { font-size: 48px; color: #00ff41; font-weight: bold; letter-spacing: 5px; }
        .qr-placeholder img { width: 200px; height: 200px; border: 10px solid white; border-radius: 10px; }
        #success-screen { display: none; color: #00ff41; }
        .status { color: #888; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="terminal-ui">
        <div id="main-screen">
            <div class="terminal-id-box">
                <div>ВАШ ID ТЕРМИНАЛА</div>
                <div id="my-id" class="id-number">------</div>
            </div>
            
            <div class="qr-placeholder">
                <!-- Вставьте сюда ссылку на QR вашего сайта оплаты -->
                <img src="api.qrserver.com" alt="QR">
                <p>Отсканируйте для оплаты</p>
            </div>
            <div class="status">Ожидание подключения клиента...</div>
        </div>

        <div id="success-screen">
            <h1>✅ ОПЛАЧЕНО</h1>
            <p>Спасибо! Оплата прошла успешно.</p>
            <button onclick="location.reload()" style="padding:10px; margin-top:20px;">Готово</button>
        </div>
    </div>

    <script>
        const FIREBASE_URL = "https://cassa-simulator-4-default-rtdb.firebaseio.com";
        let terminalId;

        // Генерация или получение ID
        document.addEventListener('DOMContentLoaded', () => {
            terminalId = Math.floor(1000 + Math.random() * 9000); // 4-значный ID для удобства ввода
            document.getElementById('my-id').innerText = terminalId;
            
            // Начинаем проверять статус в Firebase
            setInterval(checkPaymentStatus, 2000);
        });

        async function checkPaymentStatus() {
            try {
                const response = await fetch(`${FIREBASE_URL}/status/${terminalId}.json`);
                const status = await response.json();
                
                if (status === "SUCCESS") {
                    document.getElementById('main-screen').style.display = 'none';
                    document.getElementById('success-screen').style.display = 'block';
                    // Очищаем статус через 5 секунд, чтобы можно было платить снова
                    setTimeout(resetTerminal, 5000);
                }
            } catch (e) { console.error("Ошибка сети"); }
        }

        function resetTerminal() {
            fetch(`${FIREBASE_URL}/status/${terminalId}.json`, { method: 'DELETE' });
            location.reload();
        }
    </script>
</body>
</html>
