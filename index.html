<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SberPay Terminal Original</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #1a1a1a; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        #terminal {
            width: 360px; height: 720px;
            background: #00a040; /* Тот самый зеленый */
            border-radius: 40px; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
            border: 10px solid #333;
        }

        .screen { display: none; width: 100%; height: 100%; text-align: center; }
        .active { display: block; }

        /* Та самая ГАЛОЧКА и ЛОГО */
        .logo-box { margin-top: 50px; margin-bottom: 20px; }
        .sber-icon { width: 60px; height: 60px; }

        /* Твой старый текст */
        .promo-header { font-size: 38px; font-weight: 900; line-height: 1; text-align: left; padding-left: 40px; margin-top: 20px; }
        .green-text { color: #00ff41; }

        .price { font-size: 50px; font-weight: bold; margin: 40px 0; }
        
        .qr-white-box { background: #fff; padding: 15px; border-radius: 20px; display: inline-block; }

        .input-group { margin-top: 30px; }
        input { width: 80%; padding: 12px; margin: 5px 0; border-radius: 10px; border: none; font-size: 18px; }
        
        .btn-pay { background: #00ff41; color: #000; border: none; padding: 15px; border-radius: 10px; width: 80%; font-weight: bold; font-size: 20px; cursor: pointer; margin-top: 10px; }

        /* Пульсирующая точка */
        .dot { position: absolute; bottom: 20px; right: 20px; width: 10px; height: 10px; background: #00ff41; border-radius: 50%; box-shadow: 0 0 10px #00ff41; }
        .tid-text { position: absolute; bottom: 15px; left: 25px; font-size: 10px; opacity: 0.5; }
    </style>
</head>
<body>

<div id="terminal">
    <div id="wait-scr" class="screen active">
        <div class="logo-box">
            <img src="https://upload.wikimedia.org/wikipedia/commons/7/73/Sberbank_Logo_2020.svg" class="sber-icon">
        </div>
        <div class="promo-header">
            ПЛАТИТЕ<br>
            <span class="green-text">КАК ВАМ</span><br>
            УДОБНО
        </div>
        <div style="margin-top: 180px; font-size: 16px; opacity: 0.8;">Ожидание команды на оплату...</div>
    </div>

    <div id="pay-scr" class="screen">
        <div class="logo-box" style="margin-top: 30px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/7/73/Sberbank_Logo_2020.svg" class="sber-icon" style="width: 40px; height: 40px;">
        </div>
        <div id="amount-val" class="price">0 ₽</div>
        <div class="qr-white-box">
            <img id="qr-img" src="" width="160">
        </div>
        <div class="input-group">
            <input type="text" id="c-num" placeholder="Номер карты">
            <input type="password" id="c-pin" placeholder="ПИН" maxlength="4">
            <button class="btn-pay" onclick="doPay()">ОПЛАТИТЬ</button>
        </div>
    </div>

    <div id="ok-scr" class="screen">
        <div style="font-size: 120px; margin-top: 180px;">✅</div>
        <h1 style="color: #00ff41;">УСПЕШНО</h1>
    </div>

    <div class="tid-text">ТЕРМИНАЛ ID: <span id="tid-display"></span></div>
    <div class="dot"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://cassa-simulator-4-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const current_tid = Math.floor(100000 + Math.random() * 900000);
    document.getElementById('tid-display').innerText = current_tid;
    let current_sum = 0;

    // СЛУШАЕМ СУММУ ИЗ БАЗЫ
    db.ref('orders/current').on('value', (s) => {
        const val = s.val();
        if (val && val > 0) {
            current_sum = val;
            document.getElementById('amount-val').innerText = val + " ₽";
            document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=pay_${current_tid}_${val}`;
            show('pay-scr');
        }
    });

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    async function doPay() {
        const n = document.getElementById('c-num').value;
        const p = document.getElementById('c-pin').value;
        const snap = await db.ref('cards/' + n).once('value');
        const card = snap.val();

        if (card && card.pin == p) {
            if (card.balance >= current_sum) {
                await db.ref('cards/' + n).update({ balance: card.balance - current_sum });
                await db.ref('orders/current').set(0); // Сброс
                show('ok-scr');
                setTimeout(() => { location.reload(); }, 4000);
            } else { alert("Недостаточно средств"); }
        } else { alert("Ошибка данных"); }
    }
</script>
</body>
</html>
